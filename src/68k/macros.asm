
; ==============================================================================
; ------------------------------------------------------------------------------
; Mega PCM 2.0
;
; Generic macros for M68K bindings
; ------------------------------------------------------------------------------
; (c) 2023-2024, Vladikcomper
; ------------------------------------------------------------------------------

; ------------------------------------------------------------------------------
; Stops Z80 and takes over its bus
; ------------------------------------------------------------------------------
; ARGUMENTS:
;	opBusReq? - (Optional) Custom operand for Z80_BUSREQ
; ------------------------------------------------------------------------------

stopZ80: macro opBusReq
	if narg=1
		move.w	#$100, \opBusReq
		@wait\@:
			btst	#0, \opBusReq
			bne.s	@wait\@
	else
		move.w	#$100, Z80_BUSREQ
		@wait\@:
			btst	#0, Z80_BUSREQ
			bne.s	@wait\@
	endif
	endm

; ------------------------------------------------------------------------------
; Starts Z80, releases its bus
; ------------------------------------------------------------------------------
; ARGUMENTS:
;	opBusReq? - (Optional) Custom operand for Z80_BUSREQ
; ------------------------------------------------------------------------------

startZ80: macro opBusReq
	if narg=1
		move.w	#0, \opBusReq
	else
		move.w	#0, Z80_BUSREQ
	endif
	endm
